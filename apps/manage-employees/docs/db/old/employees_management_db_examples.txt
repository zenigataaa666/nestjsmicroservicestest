# Exemples Concrets d'Utilisation de la Base de Données

Voici des exemples pratiques pour chaque partie clé de votre système de gestion du personnel :

## 1. Gestion Hiérarchique des Départements

**Création d'une structure organisationnelle :**
```sql
-- Niveau 1: Direction
INSERT INTO departments (name, description) 
VALUES ('Direction Générale', 'Direction principale de l entreprise');

-- Niveau 2: Départements
INSERT INTO departments (name, description, parent_id) 
VALUES 
('Ressources Humaines', 'Gestion du personnel', 1),
('IT', 'Technologies de l information', 1),
('Finance', 'Gestion financière', 1);

-- Niveau 3: Services
INSERT INTO departments (name, description, parent_id) 
VALUES 
('Recrutement', 'Service recrutement RH', 2),
('Formation', 'Service formation RH', 2),
('Développement', 'Equipe développement IT', 3);
```

**Requête pour obtenir l'arborescence complète :**
```sql
WITH RECURSIVE dept_tree AS (
  SELECT id, name, parent_id, 0 AS level 
  FROM departments WHERE parent_id IS NULL
  
  UNION ALL
  
  SELECT d.id, d.name, d.parent_id, dt.level + 1
  FROM departments d
  JOIN dept_tree dt ON d.parent_id = dt.id
)
SELECT 
  CONCAT(REPEAT('    ', level), name) AS hierarchy,
  level
FROM dept_tree
ORDER BY level, name;
```

## 2. Gestion des Employés

**Création de postes et employés :**
```sql
-- Création de positions
INSERT INTO positions (title, level, department_id, salary_range_min, salary_range_max)
VALUES 
('Directeur RH', 'Cadre', 2, 70000, 90000),
('Développeur Senior', 'Senior', 3, 50000, 65000),
('Responsable Recrutement', 'Manager', 5, 45000, 55000);

-- Embauche d'employés
INSERT INTO employees (
  first_name, last_name, email, hire_date, position_id, department_id, salary
) VALUES 
('Jean', 'Dupont', 'j.dupont@entreprise.com', '2020-05-15', 1, 2, 75000),
('Marie', 'Martin', 'm.martin@entreprise.com', '2021-03-10', 2, 3, 55000),
('Pierre', 'Durand', 'p.durand@entreprise.com', '2022-01-20', 3, 5, 48000);
```

**Mise à jour du manager d'un département :**
```sql
-- D'abord créer un utilisateur manager
INSERT INTO users (username, email, password_hash, role, is_active)
VALUES ('mmartin', 'm.martin@entreprise.com', 'hashed_password', 'manager', 1);

-- Puis l'affecter comme manager
UPDATE departments SET manager_id = 1 WHERE id = 3; -- Marie Martin manage IT
```

## 3. Gestion des Congés

**Configuration des types de congés :**
```sql
INSERT INTO leave_types (name, description, max_days, is_paid, requires_approval)
VALUES 
('Congé annuel', 'Congé payé annuel', 25, 1, 1),
('Congé maladie', 'Absence pour maladie', 15, 1, 0),
('Congé parental', 'Congé pour parentalité', 56, 1, 1);
```

**Initialisation des soldes de congés :**
```sql
INSERT INTO leave_balances (year, days_available, leave_type_id, employee_id)
SELECT 
  2023, 
  lt.max_days, 
  lt.id, 
  e.id
FROM employees e
CROSS JOIN leave_types lt;
```

**Workflow complet d'une demande de congé :**
```sql
-- Employé crée une demande
INSERT INTO leave_requests (
  start_date, end_date, reason, employee_id, leave_type_id
) VALUES (
  '2023-07-10', '2023-07-14', 'Vacances estivales', 2, 1
);

-- Manager approuve la demande
UPDATE leave_requests 
SET 
  status = 'approved',
  approved_by = 1,
  approved_at = NOW()
WHERE id = 1;

-- Mise à jour du solde
UPDATE leave_balances 
SET days_taken = days_taken + 5 
WHERE employee_id = 2 AND leave_type_id = 1 AND year = 2023;
```

## 4. Pointage et Présence

**Enregistrement des pointages :**
```sql
-- Pointage matin
INSERT INTO attendances (date, check_in, status, employee_id)
VALUES ('2023-06-01', '08:58:00', 'present', 2);

-- Pointage soir
UPDATE attendances 
SET check_out = '17:05:00' 
WHERE employee_id = 2 AND date = '2023-06-01';

-- Cas d'absence
INSERT INTO attendances (date, status, notes, employee_id)
VALUES ('2023-06-02', 'absent', 'Maladie déclarée', 2);
```

**Rapport mensuel de présence :**
```sql
SELECT 
  e.first_name,
  e.last_name,
  COUNT(CASE WHEN a.status = 'present' THEN 1 END) AS days_present,
  COUNT(CASE WHEN a.status = 'absent' THEN 1 END) AS days_absent,
  COUNT(CASE WHEN a.status = 'late' THEN 1 END) AS days_late
FROM employees e
LEFT JOIN attendances a ON e.id = a.employee_id 
  AND a.date BETWEEN '2023-06-01' AND '2023-06-30'
GROUP BY e.id;
```

## 5. Gestion des Compétences

**Création et association de compétences :**
```sql
-- Ajout de compétences
INSERT INTO skills (name, category, description)
VALUES 
('JavaScript', 'Technique', 'Langage de programmation web'),
('React', 'Technique', 'Bibliothèque JavaScript'),
('Gestion de projet', 'Management', 'Méthodologies Agile');

-- Association aux employés
INSERT INTO employees_skills (employee_id, skill_id, proficiency_level, years_of_experience)
VALUES 
(2, 1, 'expert', 5),
(2, 2, 'advanced', 3),
(1, 3, 'intermediate', 2);
```

**Recherche d'employés par compétence :**
```sql
SELECT 
  e.first_name,
  e.last_name,
  s.name AS skill,
  es.proficiency_level
FROM employees e
JOIN employees_skills es ON e.id = es.employee_id
JOIN skills s ON es.skill_id = s.id
WHERE s.name = 'JavaScript' AND es.proficiency_level IN ('advanced', 'expert');
```

## 6. Gestion des Documents

**Upload d'un document :**
```sql
INSERT INTO documents (
  document_type, file_name, file_path, file_size, file_type, 
  description, employee_id, uploaded_by, file_hash
) VALUES (
  'Contrat', 
  'contrat_jean_dupont.pdf',
  '/uploads/documents/12345.pdf',
  250000,
  'application/pdf',
  'Contrat initial',
  1,
  3,
  'a1b2c3d4e5f6...'
);
```

**Liste des documents d'un employé :**
```sql
SELECT 
  d.document_type,
  d.file_name,
  d.created,
  u.username AS uploaded_by
FROM documents d
JOIN users u ON d.uploaded_by = u.id
WHERE d.employee_id = 1 AND d.deleted IS NULL;
```

## 7. Système de Notifications

**Création de notifications :**
```sql
-- Notification de nouvelle demande de congé
INSERT INTO notifications (
  title, message, type, related_entity_type, related_entity_id, user_id
) VALUES (
  'Nouvelle demande de congé',
  'Marie Martin a soumis une demande de congé du 10/07 au 14/07',
  'leave_request',
  'leave_requests',
  1,
  1 -- ID du manager
);

-- Notification de document expirant
INSERT INTO notifications (
  title, message, type, related_entity_type, related_entity_id, user_id
) VALUES (
  'Document à renouveler',
  'Votre certificat médical expire dans 15 jours',
  'document_alert',
  'documents',
  1,
  1 -- ID de l'employé
);
```

**Marquer une notification comme lue :**
```sql
UPDATE notifications 
SET is_read = 1 
WHERE id = 1 AND user_id = 1;
```

## 8. Requêtes Avancées

**Tableau de bord RH :**
```sql
-- Statistiques globales
SELECT 
  COUNT(DISTINCT e.id) AS total_employees,
  COUNT(DISTINCT CASE WHEN e.is_active = 1 THEN e.id END) AS active_employees,
  COUNT(DISTINCT d.id) AS total_departments,
  AVG(e.salary) AS avg_salary
FROM employees e, departments d;

-- Congés en attente d'approbation
SELECT 
  e.first_name,
  e.last_name,
  lt.name AS leave_type,
  lr.start_date,
  lr.end_date,
  DATEDIFF(lr.end_date, lr.start_date) + 1 AS days_requested
FROM leave_requests lr
JOIN employees e ON lr.employee_id = e.id
JOIN leave_types lt ON lr.leave_type_id = lt.id
WHERE lr.status = 'pending';
```

Ces exemples couvrent les principaux cas d'utilisation de votre système de gestion du personnel. Vous pouvez les adapter selon vos besoins spécifiques.